{"version":3,"sources":["page/sourcemap/component/Editor/index.js","page/sourcemap/util/index.js","util/index.js","page/sourcemap/index.js"],"names":["Editor","content","startLine","endLine","className","language","theme","value","options","readOnly","editorDidMount","editor","setTimeout","deltaDecorations","range","monaco","Range","isWholeLine","revealLineInCenter","Math","ceil","memo","map","Map","set","getFileContentFromUrl","url","a","axios","get","TabPane","Tabs","Sourcemap","console","log","type","useState","error","setError","errorVisible","setErrorVisible","result","setResult","resultVisible","setResultVisible","mapContent","sourceMap","SourceMapConsumer","with","consumer","position","originalPositionFor","line","Number","lineNo","column","columnNo","sourceContentFor","source","onInputChange","e","target","id","useEffect","window","onerror","msg","err","stack","title","visible","maskClosable","width","cancelText","centered","destroyOnClose","onCancel","okText","onOk","Item","label","onChange","TextArea","rows","defaultActiveKey","tab","onClick","Error","has"],"mappings":"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","file":"static/js/8.dd1c8b43.chunk.js","sourcesContent":["import \"./index.scss\";\nimport MonacoEditor, { monaco } from \"react-monaco-editor\";\nimport PropTypes from \"prop-types\";\nimport { memo } from \"react\";\n\nfunction Editor({ content, startLine, endLine }) {\n  const options = {\n    readOnly: true,\n  };\n  return (\n    <div className=\"editor\">\n      <MonacoEditor\n        language=\"javascript\"\n        theme=\"vs\"\n        value={content}\n        options={options}\n        editorDidMount={(editor) => {\n          if (typeof startLine !== \"number\" || typeof endLine !== \"number\") {\n            return;\n          }\n          if (startLine > endLine) {\n            return;\n          }\n          setTimeout(() => { // 解决嵌入 弹框 中设置样式失效问题\n            editor.deltaDecorations(\n              [],\n              [\n                {\n                  range: new monaco.Range(startLine, 1, endLine, 1), // 开始行，开始列，结束行，结束列\n                  options: {\n                    isWholeLine: true,\n                    className: \"editor--hightlight\",\n                  },\n                }\n              ]\n            );\n            editor.revealLineInCenter(Math.ceil((startLine + endLine) / 2));\n          }, 300);\n        }}\n      />\n    </div>\n  );\n}\n\nEditor.propTypes = {\n  content: PropTypes.string,\n  startLine: PropTypes.number,\n  endLine: PropTypes.number,\n};\n\nexport default memo(Editor);\n","// import pageContent from \"!!raw-loader!../index.js\";\n\nconst map = new Map();\nmap.set(\"page\", \"1234\");\n\nfunction readFileContent(type) {\n  return map.has(type) ? map.get(type) : \"\";\n}\n\nfunction isErrorEvent(msg) {\n  return Object.prototype.toString.call(msg) === \"[object ErrorEvent]\";\n}\n\nexport {\n  readFileContent,\n  isErrorEvent\n};","import axios from \"@/util/http\";\n\nasync function getFileContentFromUrl(url) {\n  return await axios.get(url);\n}\n\nexport {\n  getFileContentFromUrl\n};","import \"./index.scss\";\nimport { Tabs, Button, Modal, Form, Input } from \"antd\";\nimport Editor from \"./component/Editor\";\nimport { readFileContent } from \"./util\";\nimport { useEffect, useState } from \"react\";\nimport { getFileContentFromUrl } from \"@/util\";\n\nconst { TabPane } = Tabs;\n\nfunction Sourcemap() {\n  console.log(\"render sourcemap\");\n  const [error, setError] = useState({});\n  const [errorVisible, setErrorVisible] = useState(false);\n  const [result, setResult] = useState({});\n  const [resultVisible, setResultVisible] = useState(false);\n\n  useEffect(() => {\n    window.onerror = function (msg, url, lineNo, columnNo, err) {\n      setError({\n        msg,\n        url,\n        lineNo,\n        columnNo,\n        error: err.stack,\n      });\n      setErrorVisible(true);\n      console.log(error);\n      return false; // 返回 true，阻止默认行为，如在 console 中打印错误\n    };\n  }, []);\n  useEffect(async () => {\n    if (error.lineNo < 0 || error.columnNo < 0 || !error.url) {\n      return;\n    }\n    return () => {};\n  }, [error]);\n  function onClickTest_1() {\n    // setTimeout(() => {\n    throw new Error(\"test 1...\");\n    // }, 300);\n  }\n\n  async function onClicOk() {\n    const mapContent = await getFileContentFromUrl(`${error.url}.map`);\n    sourceMap.SourceMapConsumer.with(mapContent, null, (consumer) => {\n      const position = consumer.originalPositionFor({\n        line: Number(error.lineNo),\n        column: Number(error.columnNo),\n      });\n      const content = consumer.sourceContentFor(position.source);\n      console.log(\"**\", content);\n      setResultVisible(true);\n      setResult({\n        ...position,\n        content,\n      });\n    });\n  }\n\n  function onClickCancel() {\n    setErrorVisible(false);\n  }\n\n  function onInputChange(e) {\n    const { id, value } = e.target;\n    setError({\n      ...error,\n      [id]: value,\n    });\n  }\n\n  function onResultCancel() {\n    setResultVisible(false);\n  }\n\n  return (\n    <div className=\"sourcemap\">\n      <div className=\"sourcemap__desc\">\n        <h1>说明</h1>\n        <p>此页面仅用于测试 source map 功能。</p>\n      </div>\n      <Modal title=\"分析定位结果\" visible={resultVisible} maskClosable={false} width=\"80%\" cancelText=\"关闭\" centered destroyOnClose onCancel={onResultCancel}>\n        <div className=\"sourcemap__result\">\n          <Editor key=\"result\" content={result.content} startLine={result.line} endLine={result.line} />\n        </div>\n      </Modal>\n      <Modal title=\"错误信息\" visible={errorVisible} maskClosable={false} width=\"60%\" cancelText=\"关闭\" okText=\"定位分析\" centered onOk={onClicOk} onCancel={onClickCancel}>\n        <Form>\n          <Form.Item label=\"错误信息\">\n            <Input value={error.msg} />\n          </Form.Item>\n          <Form.Item label=\"错误行数\">\n            <Input value={error.lineNo} onChange={onInputChange} id=\"lineNo\" />\n          </Form.Item>\n          <Form.Item label=\"错误列数\">\n            <Input value={error.columnNo} onChange={onInputChange} id=\"columnNo\" />\n          </Form.Item>\n          <Form.Item label=\"错误文件\">\n            <Input value={error.url} onChange={onInputChange} id=\"url\" />\n          </Form.Item>\n          <Form.Item label=\"错误堆栈\">\n            <Input.TextArea value={error.error} rows={8} />\n          </Form.Item>\n        </Form>\n      </Modal>\n      <Tabs defaultActiveKey=\"1\" className=\"sourcemap__test\">\n        <TabPane tab=\"测试用例 1\" key=\"1\">\n          <div>\n            <Button type=\"primary\" className=\"sourcemap__test__btn\" onClick={onClickTest_1}>\n              测试\n            </Button>\n          </div>\n          <Editor key=\"origin\" content={readFileContent(\"page\")} className=\"sourcemap__test__editor\" startLine={37} endLine={41} />\n        </TabPane>\n        <TabPane tab=\"测试用例 2\" key=\"2\">\n          Content of Tab Pane 2\n        </TabPane>\n        <TabPane tab=\"测试用例 3\" key=\"3\">\n          Content of Tab Pane 3\n        </TabPane>\n      </Tabs>\n    </div>\n  );\n}\n\nexport default Sourcemap;\n"],"sourceRoot":""}