{"version":3,"sources":["util/index.js","page/sourcemap/component/Editor/index.js","page/sourcemap/component/ErrorTab/index.js","page/sourcemap/util/index.js","page/sourcemap/index.js","page/sourcemap/hook/useErrorListener.js"],"names":["getFileContentFromUrl","url","a","axios","get","download","name","split","pop","fetch","image","blob","imageBlob","imageURL","URL","createObjectURL","link","document","createElement","href","style","display","body","appendChild","click","removeChild","revokeObjectURL","Editor","content","startLine","endLine","editor","useRef","decorateAndScroll","setTimeout","deltaDecorations","range","monaco","Range","options","isWholeLine","className","revealLineInCenter","Math","ceil","useEffect","current","language","theme","value","readOnly","editorDidMount","e","memo","ErrorTab","desc","code","onTrigger","onAnalyze","onInputChange","errorInfo","errorResult","useState","index","setIndex","_onInputChange","target","id","_onCalculate","next","error","message","warning","lines","line","path","exec","lineNo","columnNo","length","layout","Item","label","type","onClick","bind","msg","disabled","onChange","TextArea","rows","analyzeSourcemap","mapContent","Promise","res","sourceMap","SourceMapConsumer","with","consumer","position","originalPositionFor","Number","column","sourceContentFor","source","TabPane","Tabs","Sourcemap","console","log","tabConfigList","useSelector","state","sourcemap","dispatch","useDispatch","setError","window","onerror","err","stack","onunhandledrejection","reason","useErrorListener","Error","tabConfig","find","item","key","result","editConfigList","props","editConfigListErrorInfo","defaultActiveKey","map","tab"],"mappings":"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","file":"static/js/8.d72b6f1b.chunk.js","sourcesContent":["import axios from \"@/util/http\";\n\nasync function getFileContentFromUrl(url) {\n  return await axios.get(url);\n}\n\nasync function download(url) {\n  const name = url.split(\"/\").pop().split(\"?\")[0];\n  const image = await fetch(url);\n  const imageBlob = await image.blob();\n  const imageURL = URL.createObjectURL(imageBlob);\n  const link = document.createElement(\"a\");\n  link.href = imageURL;\n  link.download = name;\n  link.style.display = \"none\";\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(imageURL);\n}\n\nexport { getFileContentFromUrl, download };\n","import \"./index.scss\";\nimport MonacoEditor, { monaco } from \"react-monaco-editor\";\nimport PropTypes from \"prop-types\";\nimport { memo, useEffect, useRef } from \"react\";\n\nfunction Editor({ content, startLine, endLine }) {\n  const options = {\n    readOnly: true,\n  };\n  const editor = useRef(null);\n\n  function decorateAndScroll(editor) {\n    if (!editor || typeof startLine !== \"number\" || typeof endLine !== \"number\") {\n      return;\n    }\n    if (startLine > endLine) {\n      return;\n    }\n    setTimeout(() => { // 解决嵌入 弹框 中设置样式失效问题\n      editor.deltaDecorations(\n        [],\n        [\n          {\n            range: new monaco.Range(startLine, 1, endLine, 1), // 开始行，开始列，结束行，结束列\n            options: {\n              isWholeLine: true,\n              className: \"editor--hightlight\",\n            },\n          }\n        ]\n      );\n      editor.revealLineInCenter(Math.ceil((startLine + endLine) / 2));\n    }, 300);\n  }\n\n  useEffect(() => {\n    decorateAndScroll(editor.current);\n  }, [content, startLine, endLine]);\n\n  return (\n    <div className=\"editor\">\n      <MonacoEditor\n        language=\"javascript\"\n        theme=\"vs\"\n        value={content}\n        options={options}\n        editorDidMount={(e) => {\n          editor.current = e;\n          decorateAndScroll(editor.current);\n        }}\n      />\n    </div>\n  );\n}\n\nEditor.propTypes = {\n  content: PropTypes.string,\n  startLine: PropTypes.number,\n  endLine: PropTypes.number,\n};\n\nexport default memo(Editor);\n","import \"./index.scss\";\nimport PropTypes from \"prop-types\";\nimport { memo, useState } from \"react\";\nimport { Form, Button, Input, message } from \"antd\";\nimport Editor from \"../Editor\";\n\nfunction ErrorTab({ name, desc, code, startLine, endLine, onTrigger, onAnalyze, onInputChange, errorInfo, errorResult }) {\n  const [index, setIndex] = useState(1);\n\n\n  function _onTrigger() {\n    typeof onTrigger === \"function\" && onTrigger(name);\n  }\n  function _onAnalyze() {\n    typeof onAnalyze === \"function\" && onAnalyze(name);\n  }\n  function _onInputChange(e) {\n    const { id, value } = e.target;\n    typeof onInputChange === \"function\" &&\n      onInputChange(name, {\n        [id]: value,\n      });\n  }\n  function _onCalculate(next) {\n    if (!errorInfo?.error) {\n      return message.warning(\"请先触发错误.\");\n    }\n    const lines = errorInfo?.error.split(\"\\n\");\n    const line = lines[index];\n    // 正则参考: https://github.com/getsentry/sentry-javascript/blob/45508c08d30a0d959c60e1449605350d782ecc47/packages/browser/src/tracekit.ts\n    const chrome = /^\\s*at (?:(.*?) ?\\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\\/).*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i;\n    const path = chrome.exec(line);\n    const [, , url, lineNo, columnNo] = path; \n    _onInputChange({\n      target: {\n        id: \"url\",\n        value: url,\n      },\n    });\n    _onInputChange({\n      target: {\n        id: \"lineNo\",\n        value: lineNo,\n      },\n    });\n    _onInputChange({\n      target: {\n        id: \"columnNo\",\n        value: columnNo,\n      },\n    });\n    if (next && index >= lines.length - 1) {\n      return message.warning(\"已是最后一个错误.\");\n    } else if(!next && index <= 1) {\n      return message.warning(\"已是第一个错误.\");\n    }\n    setIndex(next ? index + 1 : index - 1);\n  }\n\n  return (\n    <div className=\"errortab\">\n      <Form layout=\"vertical\">\n        <Form.Item label=\"用例说明\">{desc}</Form.Item>\n        <Form.Item label=\"代码示例\">\n          <div className=\"errortab__code\">\n            <Editor key=\"result\" content={code} startLine={startLine} endLine={endLine} />\n          </div>\n        </Form.Item>\n      </Form>\n\n      <div className=\"errortab__info\">\n        <div className=\"errortab__info__left\">\n          <div className=\"errortab__info__btn\">\n            <Button type=\"primary\" onClick={_onTrigger}>\n              触发错误\n            </Button>\n            <Button type=\"primary\" onClick={_onCalculate.bind(null, false)}>\n              定位上一个错误文件\n            </Button>\n            <Button type=\"primary\" onClick={_onCalculate.bind(null, true)}>\n              定位下一个错误文件\n            </Button>\n          </div>\n          <div className=\"errortab__info__btn\">\n            当前错误索引: {index}\n          </div>\n          <Form>\n            <Form.Item label=\"错误信息\">\n              <Input value={errorInfo.msg} disabled />\n            </Form.Item>\n            <Form.Item label=\"错误行数\">\n              <Input value={errorInfo.lineNo} onChange={_onInputChange} id=\"lineNo\" disabled />\n            </Form.Item>\n            <Form.Item label=\"错误列数\">\n              <Input value={errorInfo.columnNo} onChange={_onInputChange} id=\"columnNo\" disabled />\n            </Form.Item>\n            <Form.Item label=\"错误文件\">\n              <Input value={errorInfo.url} onChange={_onInputChange} id=\"url\" disabled />\n            </Form.Item>\n            <Form.Item label=\"错误堆栈\">\n              <Input.TextArea value={errorInfo.error} rows={12} disabled />\n            </Form.Item>\n          </Form>\n        </div>\n        <div className=\"errortab__info__right\">\n          <div className=\"errortab__info__btn\">\n            <Button type=\"primary\" onClick={_onAnalyze}>\n              解析 sourcemap\n            </Button>\n          </div>\n\n          <div className=\"errortab__info__edtior\">\n            <Editor key=\"result\" content={errorResult.content} startLine={errorResult.line} endLine={errorResult.line} />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nErrorTab.propTypes = {\n  name: PropTypes.string,\n  desc: PropTypes.string,\n  code: PropTypes.string,\n  startLine: PropTypes.number,\n  endLine: PropTypes.number,\n  onTrigger: PropTypes.func,\n  onAnalyze: PropTypes.func,\n  onInputChange: PropTypes.func,\n  errorInfo: PropTypes.object,\n  errorResult: PropTypes.object,\n};\n\nexport default memo(ErrorTab);\n","import { getFileContentFromUrl } from \"@/util\";\n\nasync function analyzeSourcemap(error) {\n  const mapContent = await getFileContentFromUrl(`${error.url}.map`);\n  return new Promise((res) => {\n    sourceMap.SourceMapConsumer.with(mapContent, null, (consumer) => {\n      const position = consumer.originalPositionFor({\n        line: Number(error.lineNo),\n        column: Number(error.columnNo),\n      });\n      const content = consumer.sourceContentFor(position.source);\n      res({\n        content,\n        ...position,\n      });\n    });\n  });\n}\n\nexport {\n  analyzeSourcemap\n};","import \"./index.scss\";\nimport { Tabs } from \"antd\";\nimport ErrorTab from \"./component/ErrorTab\";\nimport useErrorListener from \"./hook/useErrorListener\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { editConfigList, editConfigListErrorInfo } from \"./meta/sourcemapReducer\";\nimport { useEffect } from \"react\";\nimport { analyzeSourcemap } from \"./util\";\n\nconst { TabPane } = Tabs;\n\nfunction Sourcemap() {\n  console.log(\"render sourcemap\");\n  const tabConfigList = useSelector((state) => {\n    return state.sourcemap.tabConfigList;\n  });\n  const dispatch = useDispatch();\n  const { error } = useErrorListener();\n  useEffect(() => {\n    dispatch(\n      editConfigList({\n        key: error.name,\n        props: {\n          errorInfo: {\n            ...error,\n          },\n        },\n      })\n    );\n  }, [error]);\n\n  function onTrigger(name) {\n    if (name === \"test_1\") {\n      throw new Error(\"test_1\");\n    } else if (name === \"test_2\") {\n      new Promise(() => {\n        throw new Error(\"test_2\");\n      });\n    }\n  }\n\n  async function onAnalyze(name) {\n    const tabConfig = tabConfigList.find((item) => {\n      return item.key === name;\n    });\n    const result = await analyzeSourcemap(tabConfig.errorInfo);\n    dispatch(\n      editConfigList({\n        key: name,\n        props: {\n          errorResult: {\n            ...result,\n          },\n        },\n      })\n    );\n  }\n\n  function onInputChange(name, props) {\n    dispatch(\n      editConfigListErrorInfo({\n        key: error.name,\n        props,\n      })\n    );\n  }\n\n  return (\n    <div className=\"sourcemap\">\n      <div className=\"sourcemap__desc\">\n        <h1>说明</h1>\n        <p>此页面仅用于测试 source map 功能。</p>\n      </div>\n      <Tabs defaultActiveKey=\"test_1\" className=\"sourcemap__test\">\n        {tabConfigList.map((item) => {\n          return (\n            <TabPane tab={item.name} key={item.key}>\n              <ErrorTab {...item} name={item.key} onTrigger={onTrigger} onAnalyze={onAnalyze} onInputChange={onInputChange} />\n            </TabPane>\n          );\n        })}\n      </Tabs>\n    </div>\n  );\n}\n\nexport default Sourcemap;\n","/* eslint-disable no-debugger */\nimport { useEffect, useState } from \"react\";\n\nexport default function () {\n  const [error, setError] = useState({});\n  useEffect(() => {\n    window.onerror = function (msg, url, lineNo, columnNo, err) {\n      setError({\n        msg,\n        url,\n        lineNo,\n        columnNo,\n        error: err.stack,\n        name: err.message,\n      });\n      return false; // 返回 true，阻止默认行为，如在 console 中打印错误\n    };\n    window.onunhandledrejection = function(e) {\n      const reason = e.reason;\n      setError({\n        msg: reason.message,\n        url: \"\",\n        lineNo: \"\",\n        error: reason.stack,\n        name: reason.message,\n      });\n    };\n  }, []);\n  return {\n    error,\n  };\n}"],"sourceRoot":""}