{"version":3,"sources":["page/sourcemap/component/Editor/index.js","page/sourcemap/component/ErrorTab/index.js","util/index.js","page/sourcemap/util/index.js","page/sourcemap/index.js","page/sourcemap/hook/useErrorListener.js"],"names":["Editor","content","startLine","endLine","editor","useRef","decorateAndScroll","setTimeout","deltaDecorations","range","monaco","Range","options","isWholeLine","className","revealLineInCenter","Math","ceil","useEffect","current","language","theme","value","readOnly","editorDidMount","e","memo","ErrorTab","name","desc","code","onTrigger","onAnalyze","onInputChange","errorInfo","errorResult","_onInputChange","target","id","layout","Item","label","type","onClick","msg","disabled","lineNo","onChange","columnNo","url","TextArea","error","rows","line","getFileContentFromUrl","a","axios","get","analyzeSourcemap","mapContent","Promise","res","sourceMap","SourceMapConsumer","with","consumer","position","originalPositionFor","Number","column","sourceContentFor","source","TabPane","Tabs","Sourcemap","console","log","tabConfigList","useSelector","state","sourcemap","dispatch","useDispatch","useState","setError","window","onerror","err","stack","message","useErrorListener","Error","tabConfig","find","item","key","result","editConfigList","props","data","defaultActiveKey","map","tab"],"mappings":"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","file":"static/js/8.888ba23f.chunk.js","sourcesContent":["import \"./index.scss\";\nimport MonacoEditor, { monaco } from \"react-monaco-editor\";\nimport PropTypes from \"prop-types\";\nimport { memo, useEffect, useRef } from \"react\";\n\nfunction Editor({ content, startLine, endLine }) {\n  const options = {\n    readOnly: true,\n  };\n  const editor = useRef(null);\n\n  function decorateAndScroll(editor) {\n    if (!editor || typeof startLine !== \"number\" || typeof endLine !== \"number\") {\n      return;\n    }\n    if (startLine > endLine) {\n      return;\n    }\n    setTimeout(() => { // 解决嵌入 弹框 中设置样式失效问题\n      editor.deltaDecorations(\n        [],\n        [\n          {\n            range: new monaco.Range(startLine, 1, endLine, 1), // 开始行，开始列，结束行，结束列\n            options: {\n              isWholeLine: true,\n              className: \"editor--hightlight\",\n            },\n          }\n        ]\n      );\n      editor.revealLineInCenter(Math.ceil((startLine + endLine) / 2));\n    }, 300);\n  }\n\n  useEffect(() => {\n    decorateAndScroll(editor.current);\n  }, [content, startLine, endLine]);\n\n  return (\n    <div className=\"editor\">\n      <MonacoEditor\n        language=\"javascript\"\n        theme=\"vs\"\n        value={content}\n        options={options}\n        editorDidMount={(e) => {\n          editor.current = e;\n          decorateAndScroll(editor.current);\n        }}\n      />\n    </div>\n  );\n}\n\nEditor.propTypes = {\n  content: PropTypes.string,\n  startLine: PropTypes.number,\n  endLine: PropTypes.number,\n};\n\nexport default memo(Editor);\n","import \"./index.scss\";\nimport PropTypes from \"prop-types\";\nimport { memo } from \"react\";\nimport { Form, Button, Input } from \"antd\";\nimport Editor from \"../Editor\";\n\nfunction ErrorTab({ name, desc, code, startLine, endLine, onTrigger, onAnalyze, onInputChange, errorInfo, errorResult }) {\n  function _onTrigger() {\n    typeof onTrigger === \"function\" && onTrigger(name);\n  }\n  function _onAnalyze() {\n    typeof onAnalyze === \"function\" && onAnalyze(name);\n  }\n\n  function _onInputChange(e) {\n    const { id, value } = e.target;\n    typeof onInputChange === \"function\" && onInputChange(name, {\n      [id]: value,\n    });\n  }\n  return (\n    <div className=\"errortab\">\n      <Form layout=\"vertical\">\n        <Form.Item label=\"用例说明\">{desc}</Form.Item>\n        <Form.Item label=\"代码示例\">\n          <div className=\"errortab__code\">\n            <Editor key=\"result\" content={code} startLine={startLine} endLine={endLine} />\n          </div>\n        </Form.Item>\n      </Form>\n\n      <div className=\"errortab__info\">\n        <div className=\"errortab__info__left\">\n          <Button type=\"primary\" onClick={_onTrigger} className=\"errortab__info__btn\">\n            触发错误\n          </Button>\n          <Form>\n            <Form.Item label=\"错误信息\">\n              <Input value={errorInfo.msg} disabled />\n            </Form.Item>\n            <Form.Item label=\"错误行数\">\n              <Input value={errorInfo.lineNo} onChange={_onInputChange} id=\"lineNo\" />\n            </Form.Item>\n            <Form.Item label=\"错误列数\">\n              <Input value={errorInfo.columnNo} onChange={_onInputChange} id=\"columnNo\" />\n            </Form.Item>\n            <Form.Item label=\"错误文件\">\n              <Input value={errorInfo.url} onChange={_onInputChange} id=\"url\" />\n            </Form.Item>\n            <Form.Item label=\"错误堆栈\">\n              <Input.TextArea value={errorInfo.error} rows={12} />\n            </Form.Item>\n          </Form>\n        </div>\n        <div className=\"errortab__info__right\">\n          <Button type=\"primary\" onClick={_onAnalyze} className=\"errortab__info__btn\">\n            解析 sourcemap\n          </Button>\n          <div className=\"errortab__info__edtior\">\n            <Editor key=\"result\" content={errorResult.content} startLine={errorResult.line} endLine={errorResult.line} />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nErrorTab.propTypes = {\n  name: PropTypes.string,\n  desc: PropTypes.string,\n  code: PropTypes.string,\n  startLine: PropTypes.number,\n  endLine: PropTypes.number,\n  onTrigger: PropTypes.func,\n  onAnalyze: PropTypes.func,\n  onInputChange: PropTypes.func,\n  errorInfo: PropTypes.object,\n  errorResult: PropTypes.object,\n};\n\nexport default memo(ErrorTab);\n","import axios from \"@/util/http\";\n\nasync function getFileContentFromUrl(url) {\n  return await axios.get(url);\n}\n\nexport {\n  getFileContentFromUrl\n};","import { getFileContentFromUrl } from \"@/util\";\n\nasync function analyzeSourcemap(error) {\n  const mapContent = await getFileContentFromUrl(`${error.url}.map`);\n  return new Promise((res) => {\n    sourceMap.SourceMapConsumer.with(mapContent, null, (consumer) => {\n      const position = consumer.originalPositionFor({\n        line: Number(error.lineNo),\n        column: Number(error.columnNo),\n      });\n      const content = consumer.sourceContentFor(position.source);\n      res({\n        content,\n        ...position,\n      });\n    });\n  });\n}\n\nexport {\n  analyzeSourcemap\n};","import \"./index.scss\";\nimport { Tabs } from \"antd\";\nimport ErrorTab from \"./component/ErrorTab\";\nimport useErrorListener from \"./hook/useErrorListener\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { editConfigList } from \"./meta/sourcemapReducer\";\nimport { useEffect } from \"react\";\nimport { analyzeSourcemap } from \"./util\";\n\nconst { TabPane } = Tabs;\n\nfunction Sourcemap() {\n  console.log(\"render sourcemap\");\n  const tabConfigList = useSelector((state) => {\n    return state.sourcemap.tabConfigList;\n  });\n  const dispatch = useDispatch();\n  const { error } = useErrorListener();\n  useEffect(() => {\n    dispatch(\n      editConfigList({\n        key: error.name,\n        props: {\n          errorInfo: {\n            ...error,\n          },\n        },\n      })\n    );\n  }, [error]);\n\n  function onTrigger(name) {\n    if (name === \"test_1\") {\n      throw new Error(\"test_1\");\n    }\n  }\n\n  async function onAnalyze(name) {\n    const tabConfig = tabConfigList.find((item) => {\n      return item.key === name;\n    });\n    const result = await analyzeSourcemap(tabConfig.errorInfo);\n    dispatch(editConfigList({\n      key: name,\n      props: {\n        errorResult: {\n          ...result,\n        },\n      },\n    }));\n  }\n\n  function onInputChange(name, props) {\n    const data = tabConfigList.find(item => item.key === name);\n    dispatch(\n      editConfigList({\n        key: error.name,\n        props: {\n          errorInfo: {\n            ...data.errorInfo,\n            ...props,\n          },\n        },\n      })\n    );\n  }\n\n  return (\n    <div className=\"sourcemap\">\n      <div className=\"sourcemap__desc\">\n        <h1>说明</h1>\n        <p>此页面仅用于测试 source map 功能。</p>\n      </div>\n      <Tabs defaultActiveKey=\"1\" className=\"sourcemap__test\">\n        {tabConfigList.map((item) => {\n          return (\n            <TabPane tab={item.name} key={item.key}>\n              <ErrorTab {...item} name={item.key} onTrigger={onTrigger} onAnalyze={onAnalyze} onInputChange={onInputChange} />\n            </TabPane>\n          );\n        })}\n      </Tabs>\n    </div>\n  );\n}\n\nexport default Sourcemap;\n","/* eslint-disable no-debugger */\nimport { useEffect, useState } from \"react\";\n\nexport default function () {\n  const [error, setError] = useState({});\n  useEffect(() => {\n    window.onerror = function (msg, url, lineNo, columnNo, err) {\n      setError({\n        msg,\n        url,\n        lineNo,\n        columnNo,\n        error: err.stack,\n        name: err.message,\n      });\n      return false; // 返回 true，阻止默认行为，如在 console 中打印错误\n    };\n  }, []);\n  return {\n    error,\n  };\n}"],"sourceRoot":""}